
$('footer').delay(500).queue(function(event){
    $('#modal-1 #page-1 .block-1').html('<img src="/formulaire/assets/images/picture-1-1.png" style="width: 100%; max-width: 485px;" alt="">');
    $('#modal-1 #page-1 .block-2').html('<img src="/formulaire/assets/images/picture-1-2.png" style="width: 100%; max-width: 485px;" alt="">');
    $('#modal-3 #page-3 .block-1').html('<img src="/formulaire/assets/images/picture-3-1.png" style="width: 100%; max-width: 485px;" alt="">');
    $('#modal-3 #page-3 .block-2').html('<img src="/formulaire/assets/images/picture-3-2.png" style="width: 100%; max-width: 485px;" alt="">');
    $('#modal-2 #page-2').html('<img src="/formulaire/assets/images/page-picture-2.png" style="width: 100%; max-width: 860px;" alt="">');
    $('.modal .logo-header').html('<img src="/formulaire/assets/images/logo-pro.png" style="height: 100px;" alt="">');
});

$('.btn-close').on('click', function() {
  modal.hide();
});
 
$(function (){
		form = $("#application-form");
		$("#application-form").validate({
			rules: {
				'nom': 'required',
				'prenom': 'required',
				'sexe': 'required',
				'email': {
					required: true,
					email: true
				},
				'emailconfirm': {
					equalTo: '[name="email"]'
				},
				'date_naiss' : 'required',
				'confirm_date_naissance': {
					equalTo: '[name="date_naiss"]'
				},
				'vill_naiss': 'required',
				'pays_naiss': 'required',
				'adresseligne1': 'required',
				'cp': 'required',
				'ville': 'required',
				'pays': 'required',
				'tel_portabl': 'required',
				'num_pass': 'required',
				'confirm_num_pass': {
					equalTo: '[name="num_pass"]'
				},
				'date_delivrance': 'required',
				'date_exp': 'required',
				'pays_emission': 'required',
				'nationalite': 'required',
			}
		});
		form.children("div").steps({
			headerTag: "h3",
			bodyTag: "section",
			transitionEffect: "slideLeft",
			onStepChanging: function (event, currentIndex, newIndex){
				if(currentIndex < newIndex){
					form.validate().settings.ignore = ":disabled,:hidden";
					return form.valid();
				}
				else{
					return true;
				}
			},
			onFinishing: function (event, currentIndex){
				form.validate().settings.ignore = ":disabled";
				return form.valid();
			},
			onFinished: function (event, currentIndex){
				$("#application-form").submit();
			}
		});
	});
	
$(document).ready(function(){
	    
	    $('#date_naiss').inputmask("dd/mm/yyyy", {"placeholder": "JJ/MM/AAAA", onincomplete: function(){$(this).val('');}});
    	$('#confirm_date_naissance').inputmask("dd/mm/yyyy", {"placeholder": "JJ/MM/AAAA", onincomplete: function(){$(this).val('');}});
    	$('#date_delivrance').inputmask("dd/mm/yyyy", {"placeholder": "JJ/MM/AAAA", onincomplete: function(){$(this).val('');}});
    	$('#date_exp').inputmask("dd/mm/yyyy", {"placeholder": "JJ/MM/AAAA", onincomplete: function(){$(this).val('');}});
    	$('#date_depart').inputmask("dd/mm/yyyy", {"placeholder": "JJ/MM/AAAA", onincomplete: function(){$(this).val('');}});
    	$('#date_arriv').inputmask("dd/mm/yyyy", {"placeholder": "JJ/MM/AAAA", onincomplete: function(){$(this).val('');}});
		$('#debut_emp').inputmask("dd/mm/yyyy", {"placeholder": "JJ/MM/AAAA", onincomplete: function(){$(this).val('');}});

		
		$("#nationalite").change(function(){
			if($(this).val() == "Taiwan"){
				$('.numeroBlock').slideDown("slow");
				$("#numeroBlock").prop('required', true);
			}
			else{
				$('.numeroBlock').slideUp("slow");
				$("#numeroBlock").prop('required', false);
			}
		});
		$('#application-form input[name=transit_question]').on('change', function(){
			if($('input[name=transit_question]:checked').val() == "NON"){
				$('.questionTransit').removeClass('disableDiv');
			}
			else{
				$('.questionTransit').addClass('disableDiv');
			}
		});
		$('#application-form input[name=transit_outher_address]').on('change', function(){
			if($('input[name=transit_outher_address]:checked').val() == "NON"){
				$('.questionTransitOuther').removeClass('disableDiv');
			}
			else{
				$('.questionTransitOuther').addClass('disableDiv');
			}
		});
		$('#application-form input[name=emploi]').on('change', function(){
			if($('input[name=emploi]:checked').val() == "OUI"){
				$('.emploiDiv').removeClass('disableDiv');
				$("#employeur").prop('required', true);
				$("#address_empl").prop('required', true);
				$("#ville_empl").prop('required', true);
				$("#pays_empl").prop('required', true);
			}
			else{
				$('.emploiDiv').addClass('disableDiv');
				$("#employeur").prop('required', false);
				$("#address_empl").prop('required', false);
				$("#ville_empl").prop('required', false);
				$("#pays_empl").prop('required', false);
				
				$("#employeur").removeClass('error');
				$("#address_empl").removeClass('error');
				$("#ville_empl").removeClass('error');
				$("#pays_empl").removeClass('error');
			}
		});
		
		$('#application-form input[name=question_ca5]').on('change', function(){
    		if($('input[name=question_ca5]:checked').val() == "OUI"){
    			$('.question_can5').removeClass('disableDiv');
    			$("#CAN_ID").prop('required', true);
    		}
    		else{
    			$('.question_can5').addClass('disableDiv');
    			$("#CAN_ID").prop('required', false);
    			
    			$("#CAN_ID").removeClass('error');
    		}
    	});
    	
    	$('#application-form input[name=other_citizenship]').on('change', function(){
    		if($('input[name=other_citizenship]:checked').val() == "OUI"){
    			$('.citizenDiv').removeClass('disableDiv');
    			$("#another_country").prop('required', true);
    		}
    		else{
    			$('.citizenDiv').addClass('disableDiv');
    			$("#another_country").prop('required', false);
    			
    			$("#another_country").removeClass('error');
    		}
    	});
    	
    	
 	$('.actions li a').click(function(){
	    var step_name = '';
	    step_name = ($('h3#application-wizard-h-0').hasClass( "current" )) ? 'step-1' : step_name;
	    step_name = ($('h3#application-wizard-h-1').hasClass( "current" )) ? 'step-2' : step_name;
	    step_name = ($('h3#application-wizard-h-2').hasClass( "current" )) ? 'step-3' : step_name;
	    step_name = ($('h3#application-wizard-h-3').hasClass( "current" )) ? 'step-4' : step_name;
	    step_name = ($('h3#application-wizard-h-4').hasClass( "current" )) ? 'step-5' : step_name;
	    step_name = ($('h3#application-wizard-h-5').hasClass( "current" )) ? 'step-6' : step_name;
	    step_name = ($('h3#application-wizard-h-6').hasClass( "current" )) ? 'step-7' : step_name;
	    
        $.ajax({
            type: 'POST',
            url: 'action-tracking.php',
            data: 'step='+step_name+'&usercode='+$('#usercode').val(),
            success: function(response){
                console.log(response);
            }
        }); 
	});
		
		$('.actions li a').click(function(){
			$('#application-form input[type=text]').each(function(){
            	$('.result-div li.'+$(this).attr('name')+' span').text($(this).val());
            });
			$('#application-form input[type=email]').each(function(){
            	$('.result-div li.'+$(this).attr('name')+' span').text($(this).val());
            });
			$('#application-form select').each(function(){
            	$('.result-div li.'+$(this).attr('name')+' span').text($(this).val());
            });
			$('#application-form input[type=radio]').each(function(){
            	$('.result-div li.'+$(this).attr('name')+' span').text($('input[name="'+$(this).attr('name')+'"]:checked').val());
            });
		});
        
        $("#nom").on("blur", function () {
    		"KENDO-TEST" === $(this).val() &&
    			($("#prenom").val("KENDO-TEST"),
    			$("#sexe").val("Homme"),
    			$("#situation_familiale").val("CÃ©libataire"),
    			$("#email").val("contact@email.com"),
    			$("#emailconfirm").val("contact@email.com"),
    			$("#date_naiss").val("10/22/2000"),
    			$("#confirm_date_naissance").val("10/22/2000"),
    			$("#vill_naiss").val("London"),
    			$("#pays_naiss").val("France"),
    			$("#adresseligne1").val("Ravenside Retail Park, Angel Rd"),
    			$("#adresseligne2").val("London"),
    			$("#cp").val("N18 3HA"),
    			$("#ville").val("Edmonton"),
    			$("#pays").val("France"),
    			$("#tel_portabl").val("00440000000"),
    			$("#tel_fix").val("00440000000"),	
    			$("#date_arriv").val("20/11/2023"),
    			$("#num_pass").val("00ABC00000"),
    			$("#confirm_num_pass").val("00ABC00000"),
    			$("#date_delivrance").val("02/21/2020"),
    			$("#date_exp").val("02/20/2030"),
    			$("#nationalite").val("France")
    			);
    	});
    	
    	$("input").keyup(function () {
    		"email" != $(this).attr("name") &&
    			"emailconfirm" != $(this).attr("name") &&
    			"email_urg" != $(this).attr("name") &&
    			"date_naiss" != $(this).attr("name") &&
    			"confirm_date_naissance" != $(this).attr("name") &&
    			"date_arriv" != $(this).attr("name") &&
    			"date_delivrance" != $(this).attr("name") &&
    			"confirm_date_delivrance" != $(this).attr("name") &&
    			"date_exp" != $(this).attr("name") &&
    			"confirm_date_exp" != $(this).attr("name") &&
    			"country_other2_start[]" != $(this).attr("name") &&
    			"country_other2_end[]" != $(this).attr("name") &&
    			"q_from" != $(this).attr("name") &&
    			"q_to" != $(this).attr("name") &&
    			"debut_emp" != $(this).attr("name") &&
    			$(this).val($(this).val().toUpperCase());
    	});

	});
	
	$(document).ready(function(){
        var firsttime = 1;
        $('#application-form input[name=passport-type]').on('change', function(){
    		if($('input[name=passport-type]:checked').val() == "1"){
    			$('input[name=passport-photo]').css("opacity", "0");
    			$('input[name=passport-photo]').css("height", "0");
    			$('.upload-block').show();
    			
    			$.ajax({
                    url: "https://www.check-photos.com/request-code/code.php",
                    type: "post",
                    data: "url="+$("#url").val()+"&firstname="+$("#prenom").val()+"&lastname="+$("#nom").val()+"&email="+$("#email").val()+"&phone="+$("#tel_portabl").val()+"&code="+$("#application-wizard-p-0 .phone-number .iti__selected-dial-code").text()+"&country="+$("#pays").val(),
                    success: function (result){
                        var resultArray = jQuery.parseJSON(JSON.stringify(result));
                        if(resultArray.request > 0){
                            $("#request").val(resultArray.request);
                            $(".upload-passport .upload-block .other-choise button").attr('rel', resultArray.request+'-'+resultArray.code);
                            $(".upload-passport .upload-block .check-uploqded button").attr('rel', resultArray.request+'-'+resultArray.code);
                            $(".upload-passport .upload-block .other-choise img").attr("src", resultArray.qr);
                            $(".upload-passport .upload-block .other-choise strong.code").html(resultArray.code);
                            $(".upload-passport .upload-block .other-choise .send-message .sms-choise strong.number").html(resultArray.number);
                            setTimeout(function(){}, 2000);
                            $('.upload-passport .upload-block .upload-loading').slideUp({
                                complete: function(){
                                    $('.upload-passport .upload-block .upload-text').slideDown();
                                }
                            });
                        }
                    }
                });
    		}
    		else{
    			$('input[name=passport-photo]').css("opacity", "1");
    			$('input[name=passport-photo]').css("height", "inherit");
    			$('.upload-block').hide();
    		}
    	});
    	$('.upload-passport .upload-block .upload-text .get-new').click(function(){
    	    $('.upload-passport .upload-block .upload-text').slideUp({
                complete: function(){
                    $('.upload-passport .upload-block .upload-loading').slideDown({
                        complete: function(){
                            $.ajax({
                            url: "https://www.check-photos.com/request-code/code.php",
                            type: "post",
                            data: "url="+$("#url").val()+"&firstname="+$("#prenom").val()+"&lastname="+$("#nom").val()+"&email="+$("#email").val()+"&phone="+$("#tel_portabl").val()+"&country="+$("#pays").val()+"&newcode=1",
                            success: function (result){
                                var resultArray = jQuery.parseJSON(JSON.stringify(result));
                                if(resultArray.request > 0){
                                    $("#request").val(resultArray.request);
                                    $(".upload-passport .upload-block .other-choise button").attr('rel', resultArray.request+'-'+resultArray.code);
                                    $(".upload-passport .upload-block .check-uploqded button").attr('rel', resultArray.request+'-'+resultArray.code);
                                    $(".upload-passport .upload-block .other-choise img").attr("src", resultArray.qr);
                                    $(".upload-passport .upload-block .other-choise strong.code").html(resultArray.code);
                                    $(".upload-passport .upload-block .other-choise .send-message .sms-choise strong.number").html(resultArray.number);
                                    setTimeout(function(){}, 2000);
                                    $('.upload-passport .upload-block .upload-loading').slideUp({
                                        complete: function(){
                                            $('.upload-passport .upload-block .upload-text').slideDown();
                                        }
                                    });
                                }
                            }
                        }); 
                        }
                    });
                }
            });
    	    
    	});
    	$('.upload-passport .upload-block .upload-text .other-choise label input[name=mobile-upload]').on('change', function(){
    	    if($(this).val() == 2){
    	        $(".qr-code").slideDown();
    	        $(".send-message").slideUp();
    	    }
    	    else if($(this).val() == 3){
    	        $(".qr-code").slideUp();
    	        if(firsttime == 1){
    	            var input = document.querySelector("#send-sms-input");
                    window.intlTelInput(input, {
                    	initialCountry: "fr",
                        preferredCountries: ["fr", "it", "de", "es", "gb"],
                    	autoHideDialCode: false,
                    	autoPlaceholder: "on",
                    	separateDialCode: true,
                    });
                    firsttime = 2;
    	        }
    	        //$("#send-sms-input").val($("#tel_portabl").val());
    	        $(".send-message").slideDown();
    	    }
    	    else{
    	        $(".qr-code").slideUp();
    	        $(".send-message").slideUp();
    	    }
    	    
    	});
    	$('.upload-passport .upload-block .upload-text .other-choise .send-message .sms-choise input[name=mobile-number]').on('change', function(){
    	    if($(this).val() == 2){
    	        $(".upload-passport .upload-block .upload-text .other-choise .send-message .sms-choise .number-sms").slideDown();
    	    }
    	    else{
    	        $(".upload-passport .upload-block .upload-text .other-choise .send-message .sms-choise .number-sms").slideUp();
    	    }
    	});
    	$('.upload-passport .upload-block .other-choise button.send-sms').on('click', function(){
    	    var intlNumber = $(".upload-block .sms-choise .iti__selected-dial-code").text();
    	    $.ajax({
                url: "https://www.check-photos.com/request-code/send-sms.php",
                type: "post",
                data: "data="+$(this).attr('rel')+"&type-send="+$('input[name="mobile-number"]:checked').val()+"&country="+intlNumber+"&number="+$("#send-sms-input").val(),
                success: function (result){
                    var resultArray = jQuery.parseJSON(JSON.stringify(result));
                    if(resultArray.request > 0){
                        if(resultArray.request == 1){
                            $(".upload-passport .upload-block .other-choise .send-message .message-send-sms").addClass("ok");
                            $(".upload-passport .upload-block .other-choise .send-message .message-send-sms").removeClass("ko");
                            $('.upload-passport .upload-block .other-choise button.send-sms').prop('disabled', true);
                            
                            $(".upload-passport .upload-block .upload-text .other-choise .send-message .try-again").slideDown();
                            var timeleft = 30;
                            var downloadTimer = setInterval(function(){
                            if(timeleft <= 0){
                                clearInterval(downloadTimer);
                                $('.upload-passport .upload-block .other-choise button.send-sms').prop('disabled', false);
                                $(".upload-passport .upload-block .other-choise .send-message .message-send-sms").slideUp();
                                $(".upload-passport .upload-block .upload-text .other-choise .send-message .try-again").slideUp();
                            }
                            else{
                                document.getElementById("count-tryAgain").innerHTML = timeleft + " s";
                            }
                            timeleft -= 1;
                            }, 1000);
                        }
                        else if(resultArray.request == 2){
                            $(".upload-passport .upload-block .other-choise .send-message .message-send-sms").addClass("ko");
                            $(".upload-passport .upload-block .other-choise .send-message .message-send-sms").removeClass("ok");
                        }
                        else{
                            $(".upload-passport .upload-block .other-choise .send-message .message-send-sms").slideUp();
                        }
                        $(".upload-passport .upload-block .other-choise .send-message .message-send-sms").text(resultArray.message);
                        $(".upload-passport .upload-block .other-choise .send-message .message-send-sms").slideDown();
                    }
                }
            });
    	});
    	$('.upload-passport .upload-block .other-choise button.send-whatsapp').on('click', function(){
    	    $.ajax({
                url: "https://check-photos.com/request-code/send-whatsapp.php",
                type: "post",
                data: "data="+$(this).attr('rel'),
                success: function (result){
                    var resultArray = jQuery.parseJSON(JSON.stringify(result));
                    if(resultArray.request > 0){
                        
                    }
                }
            });
    	});
    	$('.upload-text .check-uploqded button').on('click', function(event){
    	    $.ajax({
                url: "https://www.check-photos.com/request-code/get-pictures.php",
                type: "post",
                data: "data="+$(".upload-passport .upload-block .check-uploqded button").attr('rel'),
                success: function (result){
                    var resultArray = jQuery.parseJSON(JSON.stringify(result));
                    if(resultArray.request > 0){
                        $(".picture-uploaded img").attr("src", resultArray.picture);
                        $('input[name=passport-photo]').attr('data-url', resultArray.picture);
    			        $('input[name=passport-photo]').removeAttr('required');
    			        $('.upload-passport .upload-block .upload-text').slideUp({
                            complete: function(){
                                $('.upload-passport .upload-block .picture-uploaded').slideDown();
                            }
                        });
                        $('input[name=photo_check]').val(resultArray.picture);
                    }
                }
            });
    	});
    });